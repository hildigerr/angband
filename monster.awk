#!/usr/bin/awk -f

BEGIN { FS = ","; RS = "\n{"; x = -1 }
{
  gsub(/\x27\x2c\x27\x2c/, "COMMA\x2c", $0);

  if(NF == 23) { # Comma in name

      gsub(/\x22/, "", $0);
      print "\nN:" x++ ":" $1 "," $2;

      gsub(/\s/, "", $0);
      gsub(/\(/, "", $3);
      gsub(/\)/, "", $3);
      gsub(/\|/, " | ", $3);
      gsub(/MF1_/, "", $3);
      gsub(/\(/, "", $4);
      gsub(/\)/, "", $4);
      gsub(/\|/, " | ", $4);
      gsub(/MS1_/, "", $4);
      gsub(/\(/, "", $5);
      gsub(/\)/, "", $5);
      gsub(/\|/, " | ", $5);
      gsub(/MF2_/, "", $5);
      gsub(/\(/, "", $6);
      gsub(/\)/, "", $6);
      gsub(/\|/, " | ", $6);
      gsub(/MS[23]_/, "", $6);
      gsub(/\(/, "", $7);
      gsub(/\)/, "", $7);
      gsub(/\|/, " | ", $7);
      gsub(/MS3_/, "", $7);
      gsub(/\x27/, "", $13);
      gsub(/\x7b/, "", $14);
      gsub(/\x7d/, "", $15);
      gsub(/\x7b/, "", $16);
      gsub(/\x7d/, "", $19);
      gsub(/\x27/, "", $22);
      gsub(/\x29/, "", $22);
      gsub(/\x7d/, "", $22);
      print "I:" $13 ":" $12 ":" $14 "d" $15 ":" $10 ":" $11 ":" $9 ":" $21 ":" $20 ":" $8;
      print "A:" $16 ":" $17 ":" $18 ":" $19;
      print "F:" $3, "|", $5, ($22 == "m")?"| MALE": ($22 == "f")? "| FEMALE" : ($22 == "p")? "| PLURAL" : "";
      print "S:" $4, "|", $6, "|", $7

  } else {

      gsub(/\x22/, "", $0);
      print "\nN:" x++ ":" $1;

      gsub(/\s/, "", $0);
      gsub(/\(/, "", $2);
      gsub(/\)/, "", $2);
      gsub(/\|/, " | ", $2);
      gsub(/MF1_/, "", $2);
      gsub(/\(/, "", $3);
      gsub(/\)/, "", $3);
      gsub(/\|/, " | ", $3);
      gsub(/MS1_/, "", $3);
      gsub(/\(/, "", $4);
      gsub(/\)/, "", $4);
      gsub(/\|/, " | ", $4);
      gsub(/MF2_/, "", $4);
      gsub(/\(/, "", $5);
      gsub(/\)/, "", $5);
      gsub(/\|/, " | ", $5);
      gsub(/MS[23]_/, "", $5);
      gsub(/\(/, "", $6);
      gsub(/\)/, "", $6);
      gsub(/\|/, " | ", $6);
      gsub(/MS3_/, "", $6);
      gsub(/\x27/, "", $12);
      gsub(/\x7b/, "", $13);
      gsub(/\x7d/, "", $14);
      gsub(/\x7b/, "", $15);
      gsub(/\x7d/, "", $18);
      gsub(/\x27/, "", $21);
      gsub(/\x29/, "", $21);
      gsub(/\x7d/, "", $21);
      print "I:" $12 ":" $11 ":" $13 "d" $14 ":" $9 ":" $10 ":" $8 ":" $20 ":" $19 ":" $7;
      print "A:" $15 ":" $16 ":" $17 ":" $18;
      print "F:" $2, "|", $4, ($21 == "m")?"| MALE": ($21 == "f")? "| FEMALE" : ($21 == "p")? "| PLURAL" : "";
      print "S:" $3, "|", $5, "|", $6
  }
}
